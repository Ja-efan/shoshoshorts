# 1️. 기본 서버 (기본 응답용)
server {
    listen 80 default_server;
    server_name _;  # 와일드카드 느낌, 어떤 도메인과도 매칭되지 않음

    return 444;  # 응답 없이 연결 끊기 (보안 목적)
}

# 2️. 실제 서비스용 
server {
    listen 80;
    server_name shoshoshorts.duckdns.org;
    
    # 루트 디렉토리 설정 (React 앱의 빌드 파일 위치)
    root /usr/share/nginx/html;
    index index.html;
    
    # API 요청 프록시 설정
    location /api {
        proxy_pass http://sss-backend:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
    
    # 정적 콘텐츠에 대한 캐싱 설정
    location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|mp4|ogg|ogv|webm|htc)$ {
        expires 1M;
        access_log off;
        add_header Cache-Control "public";
    }
    
    # React Router를 위한 설정 (모든 경로를 index.html로 리다이렉트)
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # 오류 페이지 설정
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
